!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Gameboy=t()}}(function(){return function o(u,a,c){function s(e,t){if(!a[e]){if(!u[e]){var r="function"==typeof require&&require;if(!t&&r)return r(e,!0);if(f)return f(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var i=a[e]={exports:{}};u[e][0].call(i.exports,function(t){return s(u[e][1][t]||t)},i,i.exports,o,u,a,c)}return a[e].exports}for(var f="function"==typeof require&&require,t=0;t<c.length;t++)s(c[t]);return s}({1:[function(t,e,r){"use strict";var o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var r=[],n=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!e||r.length!==e);n=!0);}catch(t){i=!0,o=t}finally{try{!n&&a.return&&a.return()}finally{if(i)throw o}}return r}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var u=t("debug")("gameboy:cpu"),a=t("debug")("gameboy:cpu:cycle"),c=t("debug")("gameboy:cpu:int"),s=t("raf"),f=t("./opcodes"),l=t("../util/serializable"),i=t("../interrupts"),h=i.INT_40,p=i.INT_48,_=i.INT_50,y=i.INT_58,d=i.INT_60,v=["_mmu","_timer","_lcd","_loop"],m=function(t){function i(t,e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return n._mmu=t,n._timer=e,n._lcd=r,n._loop=null,n.ime=!1,n._a=0,n._f=0,n._b=0,n._c=0,n._d=0,n._e=0,n._h=0,n._l=0,n._sp=0,n._pc=0,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(i,l({exclude:v})),n(i,[{key:"init",value:function(){this.ime=!1,this._a=0,this._f=0,this._b=0,this._c=0,this._d=0,this._e=0,this._h=0,this._l=0,this._sp=0,this._pc=0}},{key:"start",value:function(){var e=this;u("start");this._loop=s(function t(){e._step(),e._loop=s(t)})}},{key:"stop",value:function(){u("stop"),s.cancel(this._loop)}},{key:"_step",value:function(){for(var t=0,e=0;t<69905;){var r=this._runCycle()+e;this._timer.step(r),this._lcd.step(r),e=this._handleInterrupts(),t+=r}}},{key:"_runCycle",value:function(){var t=this._mmu.readByte(this._pc),e=f.$;203==t&&(t=this._mmu.readByte(this._pc+1),e=f.$[203]);var r=o(e[t],2),n=r[0],i=r[1];return a("%s; $%s",n,this._pc.toString(16)),i(this,this._mmu)}},{key:"_handleInterrupts",value:function(){if(!this.ime)return 0;var t=this._mmu.ie&this._mmu.if;if(0==t)return 0;c("flags 0b%s",t.toString(2));var e=void 0;return t&h?(this._mmu.if&=~h,e=64):t&p?(this._mmu.if&=~p,e=72):t&_?(this._mmu.if&=~_,e=80):t&y?(this._mmu.if&=~y,e=88):t&d&&(this._mmu.if&=~d,e=96),this.ime=!1,this._mmu.writeWord(this._sp-=2,this._pc),this._pc=e,20}},{key:"a",get:function(){return this._a},set:function(t){this._a=255&t}},{key:"f",get:function(){return this._f},set:function(t){this._f=240&t}},{key:"b",get:function(){return this._b},set:function(t){this._b=255&t}},{key:"c",get:function(){return this._c},set:function(t){this._c=255&t}},{key:"d",get:function(){return this._d},set:function(t){this._d=255&t}},{key:"e",get:function(){return this._e},set:function(t){this._e=255&t}},{key:"h",get:function(){return this._h},set:function(t){this._h=255&t}},{key:"l",get:function(){return this._l},set:function(t){this._l=255&t}},{key:"af",get:function(){return this._a<<8|this._f},set:function(t){this.a=t>>8,this.f=t}},{key:"bc",get:function(){return this._b<<8|this._c},set:function(t){this.b=t>>8,this.c=t}},{key:"de",get:function(){return this._d<<8|this._e},set:function(t){this.d=t>>8,this.e=t}},{key:"hl",get:function(){return this._h<<8|this._l},set:function(t){this.h=t>>8,this.l=t}},{key:"sp",get:function(){return this._sp},set:function(t){this._sp=65535&t}},{key:"pc",get:function(){return this._pc},set:function(t){this._pc=65535&t}}]),i}();e.exports=m},{"../interrupts":8,"../util/serializable":16,"./opcodes":2,debug:14,raf:20}],2:[function(t,e,r){"use strict";t("../util/number");var n=function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return function(t,e){var r=e.readByte(t.pc),n=""+o.toString(16)+r.toString(16),i=t.pc.toString(16);throw new Error("unknown opcode 0x"+n+"; $"+i)}},i=r.$=new Array(255).fill([null,n()]),o=i[203]=new Array(255).fill([null,n(203)]),u=128,a=64,c=32,s=16,f=function(r){return function(t,e){return t[r]=e.readByte(t.pc+1),t.pc+=2,8}};i[6]=["LD B,n",f("b")],i[14]=["LD C,n",f("c")],i[22]=["LD D,n",f("d")],i[30]=["LD E,n",f("e")],i[38]=["LD H,n",f("h")],i[46]=["LD L,n",f("l")];var l=function(e,r){return function(t){return t[e]=t[r],t.pc+=1,4}};i[120]=["LD A,B",l("a","b")],i[121]=["LD A,C",l("a","c")],i[122]=["LD A,D",l("a","d")],i[123]=["LD A,E",l("a","e")],i[124]=["LD A,H",l("a","h")],i[125]=["LD A,L",l("a","l")],i[127]=["LD A,A",l("a","a")],i[64]=["LD B,B",l("b","b")],i[65]=["LD B,C",l("b","c")],i[66]=["LD B,D",l("b","d")],i[67]=["LD B,E",l("b","e")],i[68]=["LD B,H",l("b","h")],i[69]=["LD B,L",l("b","l")],i[72]=["LD C,B",l("c","b")],i[73]=["LD C,C",l("c","c")],i[74]=["LD C,D",l("c","d")],i[75]=["LD C,E",l("c","e")],i[76]=["LD C,H",l("c","h")],i[77]=["LD C,L",l("c","l")],i[80]=["LD D,B",l("d","b")],i[81]=["LD D,C",l("d","c")],i[82]=["LD D,D",l("d","d")],i[83]=["LD D,E",l("d","e")],i[84]=["LD D,H",l("d","h")],i[85]=["LD D,L",l("d","l")],i[88]=["LD E,B",l("e","b")],i[89]=["LD E,C",l("e","c")],i[90]=["LD E,D",l("e","d")],i[91]=["LD E,E",l("e","e")],i[92]=["LD E,H",l("e","h")],i[93]=["LD E,L",l("e","l")],i[96]=["LD H,B",l("h","b")],i[97]=["LD H,C",l("h","c")],i[98]=["LD H,D",l("h","d")],i[99]=["LD H,E",l("h","e")],i[100]=["LD H,H",l("h","h")],i[101]=["LD H,L",l("h","l")],i[104]=["LD L,B",l("l","b")],i[105]=["LD L,C",l("l","c")],i[106]=["LD L,D",l("l","d")],i[107]=["LD L,E",l("l","e")],i[108]=["LD L,H",l("l","h")],i[109]=["LD L,L",l("l","l")];var h=function(r){return function(t,e){return t[r]=e.readByte(t.hl),t.pc+=1,8}};i[70]=["LD B,(HL)",h("b")],i[78]=["LD C,(HL)",h("c")],i[86]=["LD D,(HL)",h("d")],i[94]=["LD E,(HL)",h("e")],i[102]=["LD H,(HL)",h("h")],i[110]=["LD L,(HL)",h("l")],i[126]=["LD A,(HL)",h("a")];var p=function(r){return function(t,e){return e.writeByte(t.hl,t[r]),t.pc+=1,8}};i[112]=["LD (HL),B",p("b")],i[113]=["LD (HL),C",p("c")],i[114]=["LD (HL),D",p("d")],i[115]=["LD (HL),E",p("e")],i[116]=["LD (HL),H",p("h")],i[117]=["LD (HL),L",p("l")],i[54]=["LD (HL),n",function(t,e){return e.writeByte(t.hl,e.readByte(t.pc+1)),t.pc+=2,12}];var _=function(e){return function(t){return t.a=t[e],t.pc+=1,4}};i[120]=["LD A,B",_("b")],i[121]=["LD A,C",_("c")],i[122]=["LD A,D",_("d")],i[123]=["LD A,E",_("e")],i[124]=["LD A,H",_("h")],i[125]=["LD A,L",_("l")],i[127]=["LD A,A",_("a")];var y=function(r){return function(t,e){return t.a=e.readByte(t[r]),t.pc+=1,8}};i[10]=["LD A,(BC)",y("bc")],i[26]=["LD A,(DE)",y("de")],i[126]=["LD A,(HL)",y("hl")],i[250]=["LD A,(nn)",function(t,e){return t.a=e.readByte(e.readWord(t.pc+1)),t.pc+=3,16}],i[62]=["LD A,n",function(t,e){return t.a=e.readByte(t.pc+1),t.pc+=2,8}];var d=function(e){return function(t){return t[e]=t.a,t.pc+=1,4}};i[71]=["LD B,A",d("b")],i[79]=["LD C,A",d("c")],i[87]=["LD D,A",d("d")],i[95]=["LD E,A",d("e")],i[103]=["LD H,A",d("h")],i[111]=["LD L,A",d("l")],i[127]=["LD A,A",d("a")];var v=function(r){return function(t,e){return e.writeByte(t[r],t.a),t.pc+=1,8}};i[2]=["LD (BC),A",v("bc")],i[18]=["LD (DE),A",v("de")],i[119]=["LD (HL),A",v("hl")],i[234]=["LD (nn),A",function(t,e){return e.writeByte(e.readWord(t.pc+1),t.a),t.pc+=3,16}],i[242]=["LD A,(C)",function(t,e){return t.a=e.readByte(65280+t.c),t.pc+=1,8}],i[226]=["LD (C),A",function(t,e){return e.writeByte(65280+t.c,t.a),t.pc+=1,8}],i[58]=["LD A,(HL-)",function(t,e){return t.a=e.readByte(t.hl--),t.pc+=1,8}],i[50]=["LD (HL-),A",function(t,e){return e.writeByte(t.hl--,t.a),t.pc+=1,8}],i[42]=["LD A,(HL+)",function(t,e){return t.a=e.readByte(t.hl++),t.pc+=1,8}],i[34]=["LD (HL+),A",function(t,e){return e.writeByte(t.hl++,t.a),t.pc+=1,8}],i[224]=["LDH (n),A",function(t,e){var r=e.readByte(t.pc+1);return e.writeByte(65280+r,t.a),t.pc+=2,12}],i[240]=["LDH A,(n)",function(t,e){var r=e.readByte(t.pc+1);return t.a=e.readByte(65280+r),t.pc+=2,12}];var m=function(r){return function(t,e){return t[r]=e.readWord(t.pc+1),t.pc+=3,12}};function b(t,e){var r=e.readByte(t.pc+1).signed(),n=t.sp+r,i=t.sp^r^n;return(t.f=0)!=(16&i)&&(t.f|=c),0!=(256&i)&&(t.f|=s),n}i[1]=["LD BC,nn",m("bc")],i[17]=["LD DE,nn",m("de")],i[33]=["LD HL,nn",m("hl")],i[49]=["LD SP,nn",m("sp")],i[249]=["LD SP,HL",function(t){return t.sp=t.hl,t.pc+=1,8}],i[248]=["LD HL,SP+n",function(t,e){return t.hl=b(t,e),t.pc+=2,12}],i[8]=["LD (nn),SP",function(t,e){return e.writeWord(e.readWord(t.pc+1),t.sp),t.pc+=3,20}];var w=function(r){return function(t,e){return e.writeWord(t.sp-=2,t[r]),t.pc+=1,16}};i[197]=["PUSH BC",w("bc")],i[213]=["PUSH DE",w("de")],i[229]=["PUSH HL",w("hl")],i[245]=["PUSH AF",w("af")];var L=function(r){return function(t,e){return t[r]=e.readWord(t.sp),t.sp+=2,t.pc+=1,12}};function B(t,e){var r=t.a+e;return(t.f=0)==(255&r)&&(t.f|=u),0!=(16&(t.a^e^r))&&(t.f|=c),0!=(256&r)&&(t.f|=s),r}i[193]=["POP BC",L("bc")],i[209]=["POP DE",L("de")],i[225]=["POP HL",L("hl")],i[241]=["POP AF",L("af")];var E=function(e){return function(t){return t.a=B(t,t[e]),t.pc+=1,4}};function g(t,e){var r=t.f>>4&1,n=t.a+e+r;return(t.f=0)==(255&n)&&(t.f|=u),0!=(16&(t.a^e^n))&&(t.f|=c),0!=(256&n)&&(t.f|=s),n}i[128]=["ADD A,B",E("b")],i[129]=["ADD A,C",E("c")],i[130]=["ADD A,D",E("d")],i[131]=["ADD A,E",E("e")],i[132]=["ADD A,H",E("h")],i[133]=["ADD A,L",E("l")],i[135]=["ADD A,A",E("a")],i[134]=["ADD A,(HL)",function(t,e){var r=e.readByte(t.hl);return t.a=B(t,r),t.pc+=1,8}],i[198]=["ADD A,#",function(t,e){var r=e.readByte(t.pc+1);return t.a=B(t,r),t.pc+=2,8}];var S=function(e){return function(t){return t.a=g(t,t[e]),t.pc+=1,4}};function D(t,e){var r=t.a-e;return t.f=a,0==(255&r)&&(t.f|=u),0!=(16&(t.a^e^r))&&(t.f|=c),0!=(256&r)&&(t.f|=s),r}i[136]=["ADC A,B",S("b")],i[137]=["ADC A,C",S("c")],i[138]=["ADC A,D",S("d")],i[139]=["ADC A,E",S("e")],i[140]=["ADC A,H",S("h")],i[141]=["ADC A,L",S("l")],i[143]=["ADC A,A",S("a")],i[142]=["ADC A,(HL)",function(t,e){return t.a=g(t,e.readByte(t.hl)),t.pc+=1,8}],i[206]=["ADC A,#",function(t,e){return t.a=g(t,e.readByte(t.pc+1)),t.pc+=2,8}];var A=function(e){return function(t){return t.a=D(t,t[e]),t.pc+=1,4}};function T(t,e){var r=t.f>>4&1,n=t.a-e-r;return t.f=a,0==(255&n)&&(t.f|=u),0!=(16&(t.a^e^n))&&(t.f|=c),0!=(256&n)&&(t.f|=s),n}i[144]=["SUB B",A("b")],i[145]=["SUB C",A("c")],i[146]=["SUB D",A("d")],i[147]=["SUB E",A("e")],i[148]=["SUB H",A("h")],i[149]=["SUB L",A("l")],i[151]=["SUB A",A("a")],i[150]=["SUB (HL)",function(t,e){return t.a=D(t,e.readByte(t.hl)),t.pc+=1,8}],i[214]=["SUB #",function(t,e){return t.a=D(t,e.readByte(t.pc+1)),t.pc+=2,8}];var C=function(e){return function(t){return t.a=T(t,t[e]),t.pc+=1,4}};function R(t,e){var r=t.a&e;return t.f=c,0==(255&r)&&(t.f|=u),r}i[152]=["SBC A,B",C("b")],i[153]=["SBC A,C",C("c")],i[154]=["SBC A,D",C("d")],i[155]=["SBC A,E",C("e")],i[156]=["SBC A,H",C("h")],i[157]=["SBC A,L",C("l")],i[159]=["SBC A,A",C("a")],i[158]=["SBC A,(HL)",function(t,e){return t.a=T(t,e.readByte(t.hl)),t.pc+=1,8}],i[222]=["SBC A,#",function(t,e){return t.a=T(t,e.readByte(t.pc+1)),t.pc+=2,8}];var O=function(e){return function(t){return t.a=R(t,t[e]),t.pc+=1,4}};function H(t,e){var r=t.a|e;return(t.f=0)==(255&r)&&(t.f|=u),r}i[160]=["AND B",O("b")],i[161]=["AND C",O("c")],i[162]=["AND D",O("d")],i[163]=["AND E",O("e")],i[164]=["AND H",O("h")],i[165]=["AND L",O("l")],i[167]=["AND A",O("a")],i[166]=["AND (HL)",function(t,e){return t.a=R(t,e.readByte(t.hl)),t.pc+=1,8}],i[230]=["AND #",function(t,e){return t.a=R(t,e.readByte(t.pc+1)),t.pc+=2,8}];var k=function(e){return function(t){return t.a=H(t,t[e]),t.pc+=1,4}};function P(t,e){var r=t.a^e;return(t.f=0)==(255&r)&&(t.f|=u),r}i[176]=["OR B",k("b")],i[177]=["OR C",k("c")],i[178]=["OR D",k("d")],i[179]=["OR E",k("e")],i[180]=["OR H",k("h")],i[181]=["OR L",k("l")],i[183]=["OR A",k("a")],i[182]=["OR (HL)",function(t,e){return t.a=H(t,e.readByte(t.hl)),t.pc+=1,4}],i[246]=["OR #",function(t,e){return t.a=H(t,e.readByte(t.pc+1)),t.pc+=2,4}];var j=function(e){return function(t){return t.a=P(t,t[e]),t.pc+=1,4}};i[168]=["XOR B",j("b")],i[169]=["XOR C",j("c")],i[170]=["XOR D",j("d")],i[171]=["XOR E",j("e")],i[172]=["XOR H",j("h")],i[173]=["XOR L",j("l")],i[175]=["XOR A",j("a")],i[174]=["XOR (HL)",function(t,e){return t.a=P(t,e.readByte(t.hl)),t.pc+=1,8}],i[238]=["XOR #",function(t,e){return t.a=P(t,e.readByte(t.pc+1)),t.pc+=2,8}];var I=function(e){return function(t){return D(t,t[e]),t.pc+=1,4}};function x(t,e){var r=e+1;return t.f&=-225,0==(255&r)&&(t.f|=u),15==(15&e)&&(t.f|=c),r}i[184]=["CP B",I("b")],i[185]=["CP C",I("c")],i[186]=["CP D",I("d")],i[187]=["CP E",I("e")],i[188]=["CP H",I("h")],i[189]=["CP L",I("l")],i[191]=["CP A",I("a")],i[190]=["CP (HL)",function(t,e){return D(t,e.readByte(t.hl)),t.pc+=1,8}],i[254]=["CP #",function(t,e){return D(t,e.readByte(t.pc+1)),t.pc+=2,8}];var N=function(e){return function(t){return t[e]=x(t,t[e]),t.pc+=1,4}};function M(t,e){var r=e-1;return t.f&=-225,0==(255&r)&&(t.f|=u),t.f|=a,0==(15&e)&&(t.f|=c),r}i[4]=["INC B",N("b")],i[12]=["INC C",N("c")],i[20]=["INC D",N("d")],i[28]=["INC E",N("e")],i[36]=["INC H",N("h")],i[44]=["INC L",N("l")],i[60]=["INC A",N("a")],i[52]=["INC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,x(t,r)),t.pc+=1,12}];var U=function(e){return function(t){return t[e]=M(t,t[e]),t.pc+=1,4}};i[5]=["DEC B",U("b")],i[13]=["DEC C",U("c")],i[21]=["DEC D",U("d")],i[29]=["DEC E",U("e")],i[37]=["DEC H",U("h")],i[45]=["DEC L",U("l")],i[61]=["DEC A",U("a")],i[53]=["DEC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,M(t,r)),t.pc+=1,12}];var W=function(n){return function(t,e){var r=t.hl+t[n];return t.f&=-113,0!=(4096&(t.hl^t[n]^r))&&(t.f|=c),0!=(65536&r)&&(t.f|=s),t.hl=r,t.pc+=1,8}};i[9]=["ADD HL,BC",W("bc")],i[25]=["ADD HL,DE",W("de")],i[41]=["ADD HL,HL",W("hl")],i[57]=["ADD HL,SP",W("sp")],i[232]=["ADD SP,#",function(t,e){return t.sp=b(t,e),t.pc+=2,16}];var z=function(e){return function(t){return t[e]++,t.pc+=1,8}};i[3]=["INC BC",z("bc")],i[19]=["INC DE",z("de")],i[35]=["INC HL",z("hl")],i[51]=["INC SP",z("sp")];var J=function(e){return function(t){return t[e]--,t.pc+=1,8}};function F(t,e){var r=e<<4|e>>4;return(t.f=0)==(255&r)&&(t.f|=u),r}i[11]=["DEC BC",J("bc")],i[27]=["DEC DE",J("de")],i[43]=["DEC HL",J("hl")],i[59]=["DEC SP",J("sp")];var X=function(e){return function(t){return t[e]=F(t,t[e]),t.pc+=2,8}};function Y(t,e){var r=e<<1|e>>7;return(t.f=0)==(255&r)&&(t.f|=u),0!=(128&e)&&(t.f|=s),r}o[48]=["SWAP B",X("b")],o[49]=["SWAP C",X("c")],o[50]=["SWAP D",X("d")],o[51]=["SWAP E",X("e")],o[52]=["SWAP H",X("h")],o[53]=["SWAP L",X("l")],o[55]=["SWAP A",X("a")],o[54]=["SWAP (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,F(t,r)),t.pc+=2,16}],i[39]=["DAA",function(t){var e=void 0,r=0;return t.f&c&&(r|=6),t.f&s&&(r|=96),t.f&a?e=t.a-r:(9<(15&t.a)&&(r|=6),153<t.a&&(r|=96),e=t.a+r),t.f&=-177,0==(255&e)&&(t.f|=u),0!=(96&r)&&(t.f|=s),t.a=e,t.pc+=1,4}],i[47]=["CPL",function(t){return t.a^=255,t.f|=96,t.pc+=1,4}],i[63]=["CCF",function(t){return t.f&=-97,t.f^=s,t.pc+=1,4}],i[55]=["SCF",function(t){return t.f&=-97,t.f|=s,t.pc+=1,4}],i[0]=["NOP",function(t){return t.pc+=1,4}],i[118]=["HALT",function(t){return t.pc+=1,4}],i[16]=["STOP",function(t){return t.pc+=2,4}],i[243]=["DI",function(t){return t.ime=!1,t.pc+=1,4}],i[251]=["EI",function(t){return t.ime=!0,t.pc+=1,4}],i[7]=["RLCA",function(t){var e=t.a>>7;return(t.f=0)!=e&&(t.f|=s),t.a=t.a<<1|e,t.pc+=1,4}],i[23]=["RLA",function(t){var e=t.a>>7,r=t.f>>4&1;return(t.f=0)!=e&&(t.f|=s),t.a=t.a<<1|r,t.pc+=1,4}],i[15]=["RRCA",function(t){var e=1&t.a;return(t.f=0)!=e&&(t.f|=s),t.a=t.a>>1|e<<7,t.pc+=1,4}],i[31]=["RRA",function(t){var e=1&t.a,r=t.f>>4&1;return(t.f=0)!=e&&(t.f|=s),t.a=t.a>>1|r<<7,t.pc+=1,4}];var q=function(e){return function(t){return t[e]=Y(t,t[e]),t.pc+=2,8}};function Z(t,e){var r=e<<1|t.f>>4&1;return(t.f=0)==(255&r)&&(t.f|=u),0!=(128&e)&&(t.f|=s),r}o[0]=["RLC B",q("b")],o[1]=["RLC C",q("c")],o[2]=["RLC D",q("d")],o[3]=["RLC E",q("e")],o[4]=["RLC H",q("h")],o[5]=["RLC L",q("l")],o[7]=["RLC A",q("a")],o[6]=["RLC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,Y(t,r)),t.pc+=2,16}];var $=function(e){return function(t){return t[e]=Z(t,t[e]),t.pc+=2,8}};function G(t,e){var r=e>>1|e<<7;return(t.f=0)==(255&r)&&(t.f|=u),0!=(1&e)&&(t.f|=s),r}o[16]=["RL B",$("b")],o[17]=["RL C",$("c")],o[18]=["RL D",$("d")],o[19]=["RL E",$("e")],o[20]=["RL H",$("h")],o[21]=["RL L",$("l")],o[23]=["RL A",$("a")],o[22]=["RL (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,Z(t,r)),t.pc+=2,16}];var V=function(e){return function(t){return t[e]=G(t,t[e]),t.pc+=2,8}};function K(t,e){var r=(t.f>>4&1)<<7|e>>1;return(t.f=0)==(255&r)&&(t.f|=u),0!=(1&e)&&(t.f|=s),r}o[8]=["RRC B",V("b")],o[9]=["RRC C",V("c")],o[10]=["RRC D",V("d")],o[11]=["RRC E",V("e")],o[12]=["RRC H",V("h")],o[13]=["RRC L",V("l")],o[15]=["RRC A",V("a")],o[14]=["RRC (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,G(t,r)),t.pc+=2,16}];var Q=function(e){return function(t){return t[e]=K(t,t[e]),t.pc+=2,8}};function tt(t,e){var r=e<<1;return(t.f=0)==(255&r)&&(t.f|=u),0!=(128&e)&&(t.f|=s),r}o[24]=["RR B",Q("b")],o[25]=["RR C",Q("c")],o[26]=["RR D",Q("d")],o[27]=["RR E",Q("e")],o[28]=["RR H",Q("h")],o[29]=["RR L",Q("l")],o[31]=["RR A",Q("a")],o[30]=["RR (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,K(t,r)),t.pc+=2,16}];var et=function(e){return function(t){return t[e]=tt(t,t[e]),t.pc+=2,8}};function rt(t,e){var r=128&e|e>>1;return(t.f=0)==(255&r)&&(t.f|=u),0!=(1&e)&&(t.f|=s),r}o[32]=["SLA B",et("b")],o[33]=["SLA C",et("c")],o[34]=["SLA D",et("d")],o[35]=["SLA E",et("e")],o[36]=["SLA H",et("h")],o[37]=["SLA L",et("l")],o[39]=["SLA A",et("a")],o[38]=["SLA (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,tt(t,r)),t.pc+=2,16}];var nt=function(e){return function(t){return t[e]=rt(t,t[e]),t.pc+=2,8}};function it(t,e){var r=e>>1;return(t.f=0)==(255&r)&&(t.f|=u),0!=(1&e)&&(t.f|=s),r}o[40]=["SRA B",nt("b")],o[41]=["SRA C",nt("c")],o[42]=["SRA D",nt("d")],o[43]=["SRA E",nt("e")],o[44]=["SRA H",nt("h")],o[45]=["SRA L",nt("l")],o[47]=["SRA A",nt("a")],o[46]=["SRA (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,rt(t,r)),t.pc+=2,16}];var ot=function(e){return function(t){return t[e]=it(t,t[e]),t.pc+=2,8}};function ut(t,e,r){var n=r&1<<e;return t.f&=-225,0==n&&(t.f|=u),t.f|=c,n}o[56]=["SRL B",ot("b")],o[57]=["SRL C",ot("c")],o[58]=["SRL D",ot("d")],o[59]=["SRL E",ot("e")],o[60]=["SRL H",ot("h")],o[61]=["SRL L",ot("l")],o[63]=["SRL A",ot("a")],o[62]=["SRL (HL)",function(t,e){var r=e.readByte(t.hl);return e.writeByte(t.hl,it(t,r)),t.pc+=2,16}];var at=function(e,r){return function(t){return ut(t,e,t[r]),t.pc+=2,8}};o[64]=["BIT 0,B",at(0,"b")],o[65]=["BIT 0,C",at(0,"c")],o[66]=["BIT 0,D",at(0,"d")],o[67]=["BIT 0,E",at(0,"e")],o[68]=["BIT 0,H",at(0,"h")],o[69]=["BIT 0,L",at(0,"l")],o[71]=["BIT 0,A",at(0,"a")],o[72]=["BIT 1,B",at(1,"b")],o[73]=["BIT 1,C",at(1,"c")],o[74]=["BIT 1,D",at(1,"d")],o[75]=["BIT 1,E",at(1,"e")],o[76]=["BIT 1,H",at(1,"h")],o[77]=["BIT 1,L",at(1,"l")],o[79]=["BIT 1,A",at(1,"a")],o[80]=["BIT 2,B",at(2,"b")],o[81]=["BIT 2,C",at(2,"c")],o[82]=["BIT 2,D",at(2,"d")],o[83]=["BIT 2,E",at(2,"e")],o[84]=["BIT 2,H",at(2,"h")],o[85]=["BIT 2,L",at(2,"l")],o[87]=["BIT 2,A",at(2,"a")],o[88]=["BIT 3,B",at(3,"b")],o[89]=["BIT 3,C",at(3,"c")],o[90]=["BIT 3,D",at(3,"d")],o[91]=["BIT 3,E",at(3,"e")],o[92]=["BIT 3,H",at(3,"h")],o[93]=["BIT 3,L",at(3,"l")],o[95]=["BIT 3,A",at(3,"a")],o[96]=["BIT 4,B",at(4,"b")],o[97]=["BIT 4,C",at(4,"c")],o[98]=["BIT 4,D",at(4,"d")],o[99]=["BIT 4,E",at(4,"e")],o[100]=["BIT 4,H",at(4,"h")],o[101]=["BIT 4,L",at(4,"l")],o[103]=["BIT 4,A",at(4,"a")],o[104]=["BIT 5,B",at(5,"b")],o[105]=["BIT 5,C",at(5,"c")],o[106]=["BIT 5,D",at(5,"d")],o[107]=["BIT 5,E",at(5,"e")],o[108]=["BIT 5,H",at(5,"h")],o[109]=["BIT 5,L",at(5,"l")],o[111]=["BIT 5,A",at(5,"a")],o[112]=["BIT 6,B",at(6,"b")],o[113]=["BIT 6,C",at(6,"c")],o[114]=["BIT 6,D",at(6,"d")],o[115]=["BIT 6,E",at(6,"e")],o[116]=["BIT 6,H",at(6,"h")],o[117]=["BIT 6,L",at(6,"l")],o[119]=["BIT 6,A",at(6,"a")],o[120]=["BIT 7,B",at(7,"b")],o[121]=["BIT 7,C",at(7,"c")],o[122]=["BIT 7,D",at(7,"d")],o[123]=["BIT 7,E",at(7,"e")],o[124]=["BIT 7,H",at(7,"h")],o[125]=["BIT 7,L",at(7,"l")],o[127]=["BIT 7,A",at(7,"a")];var ct=function(r){return function(t,e){return ut(t,r,e.readByte(t.hl)),t.pc+=2,16}};o[70]=["BIT 0,(HL)",ct(0)],o[78]=["BIT 1,(HL)",ct(1)],o[86]=["BIT 2,(HL)",ct(2)],o[94]=["BIT 3,(HL)",ct(3)],o[102]=["BIT 4,(HL)",ct(4)],o[110]=["BIT 5,(HL)",ct(5)],o[118]=["BIT 6,(HL)",ct(6)],o[126]=["BIT 7,(HL)",ct(7)];var st=function(e,r){return function(t){return t[r]|=1<<e,t.pc+=2,8}};o[192]=["SET 0,B",st(0,"b")],o[193]=["SET 0,C",st(0,"c")],o[194]=["SET 0,D",st(0,"d")],o[195]=["SET 0,E",st(0,"e")],o[196]=["SET 0,H",st(0,"h")],o[197]=["SET 0,L",st(0,"l")],o[199]=["SET 0,A",st(0,"a")],o[200]=["SET 1,B",st(1,"b")],o[201]=["SET 1,C",st(1,"c")],o[202]=["SET 1,D",st(1,"d")],o[203]=["SET 1,E",st(1,"e")],o[204]=["SET 1,H",st(1,"h")],o[205]=["SET 1,L",st(1,"l")],o[207]=["SET 1,A",st(1,"a")],o[208]=["SET 2,B",st(2,"b")],o[209]=["SET 2,C",st(2,"c")],o[210]=["SET 2,D",st(2,"d")],o[211]=["SET 2,E",st(2,"e")],o[212]=["SET 2,H",st(2,"h")],o[213]=["SET 2,L",st(2,"l")],o[215]=["SET 2,A",st(2,"a")],o[216]=["SET 3,B",st(3,"b")],o[217]=["SET 3,C",st(3,"c")],o[218]=["SET 3,D",st(3,"d")],o[219]=["SET 3,E",st(3,"e")],o[220]=["SET 3,H",st(3,"h")],o[221]=["SET 3,L",st(3,"l")],o[223]=["SET 3,A",st(3,"a")],o[224]=["SET 4,B",st(4,"b")],o[225]=["SET 4,C",st(4,"c")],o[226]=["SET 4,D",st(4,"d")],o[227]=["SET 4,E",st(4,"e")],o[228]=["SET 4,H",st(4,"h")],o[229]=["SET 4,L",st(4,"l")],o[231]=["SET 4,A",st(4,"a")],o[232]=["SET 5,B",st(5,"b")],o[233]=["SET 5,C",st(5,"c")],o[234]=["SET 5,D",st(5,"d")],o[235]=["SET 5,E",st(5,"e")],o[236]=["SET 5,H",st(5,"h")],o[237]=["SET 5,L",st(5,"l")],o[239]=["SET 5,A",st(5,"a")],o[240]=["SET 6,B",st(6,"b")],o[241]=["SET 6,C",st(6,"c")],o[242]=["SET 6,D",st(6,"d")],o[243]=["SET 6,E",st(6,"e")],o[244]=["SET 6,H",st(6,"h")],o[245]=["SET 6,L",st(6,"l")],o[247]=["SET 6,A",st(6,"a")],o[248]=["SET 7,B",st(7,"b")],o[249]=["SET 7,C",st(7,"c")],o[250]=["SET 7,D",st(7,"d")],o[251]=["SET 7,E",st(7,"e")],o[252]=["SET 7,H",st(7,"h")],o[253]=["SET 7,L",st(7,"l")],o[255]=["SET 7,A",st(7,"a")];var ft=function(r){return function(t,e){return e.writeByte(t.hl,e.readByte(t.hl)|1<<r),t.pc+=2,16}};o[198]=["SET 0,(HL)",ft(0)],o[206]=["SET 1,(HL)",ft(1)],o[214]=["SET 2,(HL)",ft(2)],o[222]=["SET 3,(HL)",ft(3)],o[230]=["SET 4,(HL)",ft(4)],o[238]=["SET 5,(HL)",ft(5)],o[246]=["SET 6,(HL)",ft(6)],o[254]=["SET 7,(HL)",ft(7)];var lt=function(e,r){return function(t){return t[r]&=~(1<<e),t.pc+=2,8}};o[128]=["RES 0,B",lt(0,"b")],o[129]=["RES 0,C",lt(0,"c")],o[130]=["RES 0,D",lt(0,"d")],o[131]=["RES 0,E",lt(0,"e")],o[132]=["RES 0,H",lt(0,"h")],o[133]=["RES 0,L",lt(0,"l")],o[135]=["RES 0,A",lt(0,"a")],o[136]=["RES 1,B",lt(1,"b")],o[137]=["RES 1,C",lt(1,"c")],o[138]=["RES 1,D",lt(1,"d")],o[139]=["RES 1,E",lt(1,"e")],o[140]=["RES 1,H",lt(1,"h")],o[141]=["RES 1,L",lt(1,"l")],o[143]=["RES 1,A",lt(1,"a")],o[144]=["RES 2,B",lt(2,"b")],o[145]=["RES 2,C",lt(2,"c")],o[146]=["RES 2,D",lt(2,"d")],o[147]=["RES 2,E",lt(2,"e")],o[148]=["RES 2,H",lt(2,"h")],o[149]=["RES 2,L",lt(2,"l")],o[151]=["RES 2,A",lt(2,"a")],o[152]=["RES 3,B",lt(3,"b")],o[153]=["RES 3,C",lt(3,"c")],o[154]=["RES 3,D",lt(3,"d")],o[155]=["RES 3,E",lt(3,"e")],o[156]=["RES 3,H",lt(3,"h")],o[157]=["RES 3,L",lt(3,"l")],o[159]=["RES 3,A",lt(3,"a")],o[160]=["RES 4,B",lt(4,"b")],o[161]=["RES 4,C",lt(4,"c")],o[162]=["RES 4,D",lt(4,"d")],o[163]=["RES 4,E",lt(4,"e")],o[164]=["RES 4,H",lt(4,"h")],o[165]=["RES 4,L",lt(4,"l")],o[167]=["RES 4,A",lt(4,"a")],o[168]=["RES 5,B",lt(5,"b")],o[169]=["RES 5,C",lt(5,"c")],o[170]=["RES 5,D",lt(5,"d")],o[171]=["RES 5,E",lt(5,"e")],o[172]=["RES 5,H",lt(5,"h")],o[173]=["RES 5,L",lt(5,"l")],o[175]=["RES 5,A",lt(5,"a")],o[176]=["RES 6,B",lt(6,"b")],o[177]=["RES 6,C",lt(6,"c")],o[178]=["RES 6,D",lt(6,"d")],o[179]=["RES 6,E",lt(6,"e")],o[180]=["RES 6,H",lt(6,"h")],o[181]=["RES 6,L",lt(6,"l")],o[183]=["RES 6,A",lt(6,"a")],o[184]=["RES 7,B",lt(7,"b")],o[185]=["RES 7,C",lt(7,"c")],o[186]=["RES 7,D",lt(7,"d")],o[187]=["RES 7,E",lt(7,"e")],o[188]=["RES 7,H",lt(7,"h")],o[189]=["RES 7,L",lt(7,"l")],o[191]=["RES 7,A",lt(7,"a")];var ht=function(r){return function(t,e){return e.writeByte(t.hl,e.readByte(t.hl)&~(1<<r)),t.pc+=2,16}};o[134]=["RES 0,(HL)",ht(0)],o[142]=["RES 1,(HL)",ht(1)],o[150]=["RES 2,(HL)",ht(2)],o[158]=["RES 3,(HL)",ht(3)],o[166]=["RES 4,(HL)",ht(4)],o[174]=["RES 5,(HL)",ht(5)],o[182]=["RES 6,(HL)",ht(6)],o[190]=["RES 7,(HL)",ht(7)],i[195]=["JP nn",function(t,e){return t.pc=e.readWord(t.pc+1),16}];var pt=function(t,e,r){return r?(t.pc=e.readWord(t.pc+1),16):(t.pc+=3,12)};i[194]=["JP NZ,nn",function(t,e){return pt(t,e,!(t.f&u))}],i[210]=["JP NC,nn",function(t,e){return pt(t,e,!(t.f&s))}],i[202]=["JP Z,nn",function(t,e){return pt(t,e,t.f&u)}],i[218]=["JP C,nn",function(t,e){return pt(t,e,t.f&s)}],i[233]=["JP (HL)",function(t){return t.pc=t.hl,4}],i[24]=["JR n",function(t,e){return t.pc+=2+e.readByte(t.pc+1).signed(),12}];var _t=function(t,e,r){return r?(t.pc+=2+e.readByte(t.pc+1).signed(),12):(t.pc+=2,8)};i[32]=["JR NZ,n",function(t,e){return _t(t,e,!(t.f&u))}],i[48]=["JR NC,n",function(t,e){return _t(t,e,!(t.f&s))}],i[40]=["JR Z,n",function(t,e){return _t(t,e,t.f&u)}],i[56]=["JR C,n",function(t,e){return _t(t,e,t.f&s)}],i[205]=["CALL nn",function(t,e){return e.writeWord(t.sp-=2,t.pc+3),t.pc=e.readWord(t.pc+1),24}];var yt=function(t,e,r){return r?(e.writeWord(t.sp-=2,t.pc+3),t.pc=e.readWord(t.pc+1),24):(t.pc+=3,12)};i[196]=["CALL NZ,nn",function(t,e){return yt(t,e,!(t.f&u))}],i[212]=["CALL NC,nn",function(t,e){return yt(t,e,!(t.f&s))}],i[204]=["CALL Z,nn",function(t,e){return yt(t,e,t.f&u)}],i[220]=["CALL C,nn",function(t,e){return yt(t,e,t.f&s)}];var dt=function(r){return function(t,e){return e.writeWord(t.sp-=2,t.pc+1),t.pc=r,16}};i[199]=["RST 00H",dt(0)],i[207]=["RST 08H",dt(8)],i[215]=["RST 10H",dt(16)],i[223]=["RST 18H",dt(24)],i[231]=["RST 20H",dt(32)],i[239]=["RST 28H",dt(40)],i[247]=["RST 30H",dt(48)],i[255]=["RST 38H",dt(56)],i[201]=["RET",function(t,e){return t.pc=e.readWord(t.sp),t.sp+=2,16}];var vt=function(t,e,r){return r?(t.pc=e.readWord(t.sp),t.sp+=2,20):(t.pc+=1,8)};i[192]=["RET NZ",function(t,e){return vt(t,e,!(t.f&u))}],i[208]=["RET NC",function(t,e){return vt(t,e,!(t.f&s))}],i[200]=["RET Z",function(t,e){return vt(t,e,t.f&u)}],i[216]=["RET C",function(t,e){return vt(t,e,t.f&s)}],i[217]=["RETI",function(t,e){return t.pc=e.readWord(t.sp),t.sp+=2,t.ime=!0,16}]},{"../util/number":15}],3:[function(t,e,r){"use strict";var n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var i=t("debug")("gameboy:timer:step"),o=t("debug")("gameboy:timer:divider"),u=t("debug")("gameboy:timer:counter"),a=t("../util/serializable"),c=t("../registers"),s=c.DIV,f=c.TIMA,l=c.TMA,h=c.TAC,p=t("../interrupts").INT_50,_=16384,y=[];y[0]=4096,y[1]=262144,y[2]=65536,y[3]=16384;var d=function(t){function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e._mmu=t,e._div=0,e._tima=0,e._tma=0,e._tac=0,e._divider=_,e._t=y[0],e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(r,a({exclude:["_mmu"]})),n(r,[{key:"init",value:function(){this._div=0,this._tima=0,this._tma=0,this._tac=0,this._divider=_,this._t=y[0]}},{key:"step",value:function(t){i("%d",t),this._divider-=t,this._divider<=0&&(this._div=255&++this._div,o("0x%s",this._div.toString(16)),this._divider+=_),0!=(4&this._tac)&&(this._t-=t,0<this._t||(this._tima=255&++this._tima,0==this._tima&&(this._tima=this._tma,this._mmu.if|=p),u("0x%s",this._tima.toString(16)),this._t+=y[3&this._tac]))}},{key:"readByte",value:function(t){switch(t){case s:return this._div;case f:return this._tima;case l:return this._tma;case h:return this._tac}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case s:return this._div=0;case f:return this._tima=e;case l:return this._tma=e;case h:return this._tac=e}throw new Error("unmapped address 0x"+t.toString(16))}}]),r}();e.exports=d},{"../interrupts":8,"../registers":12,"../util/serializable":16,debug:14}],4:[function(t,e,r){"use strict";var n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var f=t("./gpu/video"),l=t("./cpu/timer"),h=t("./gpu/lcd"),p=t("./mmu"),_=t("./gpu/gpu"),y=t("./cpu/cpu"),d=t("./io/joypad"),i=t("./util/serializable"),o=["_joypad","_useBios","_isRunning"],u=function(t){function s(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this)),r=new p(t),n=new f,i=new _(n),o=new l(r),u=new h(r,i),a=new y(r,o,u),c=new d(r);return e._video=n,e._timer=o,e._lcd=u,e._mmu=r,e._gpu=i,e._cpu=a,e._joypad=c,r.video=n,r.timer=o,r.lcd=u,r.gpu=i,r.joypad=c,e._useBios=t&&0<t.length,e._isRunning=!1,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(s,i({exclude:o})),n(s,[{key:"loadCart",value:function(t){this._isRunning=!1,this._cpu.stop(),this._mmu.loadCart(t)}},{key:"start",value:function(){this._isRunning=!0,this._init(),this._cpu.start()}},{key:"pauseResume",value:function(){this._isRunning=!this._isRunning,this._isRunning?this._cpu.start():this._cpu.stop()}},{key:"reset",value:function(){this._isRunning=!1,this._cpu.stop(),this.start()}},{key:"_init",value:function(){this._timer.init(),this._lcd.init(),this._mmu.init(),this._cpu.init(),this._useBios||(this._cpu.pc=256,this._cpu.af=432,this._cpu.bc=19,this._cpu.de=216,this._cpu.hl=333,this._cpu.sp=65534,this._mmu.writeByte(65285,0),this._mmu.writeByte(65286,0),this._mmu.writeByte(65287,0),this._mmu.writeByte(65296,128),this._mmu.writeByte(65297,191),this._mmu.writeByte(65298,243),this._mmu.writeByte(65300,191),this._mmu.writeByte(65302,63),this._mmu.writeByte(65303,0),this._mmu.writeByte(65305,191),this._mmu.writeByte(65306,127),this._mmu.writeByte(65307,255),this._mmu.writeByte(65308,159),this._mmu.writeByte(65310,191),this._mmu.writeByte(65312,255),this._mmu.writeByte(65313,0),this._mmu.writeByte(65314,0),this._mmu.writeByte(65315,191),this._mmu.writeByte(65316,119),this._mmu.writeByte(65317,243),this._mmu.writeByte(65318,241),this._mmu.writeByte(65344,145),this._mmu.writeByte(65346,0),this._mmu.writeByte(65347,0),this._mmu.writeByte(65349,0),this._mmu.writeByte(65351,252),this._mmu.writeByte(65352,255),this._mmu.writeByte(65353,255),this._mmu.writeByte(65354,0),this._mmu.writeByte(65355,0),this._mmu.writeByte(65535,0))}},{key:"gpu",get:function(){return this._gpu}},{key:"joypad",get:function(){return this._joypad}}]),s}();e.exports=u},{"./cpu/cpu":1,"./cpu/timer":3,"./gpu/gpu":5,"./gpu/lcd":6,"./gpu/video":7,"./io/joypad":10,"./mmu":11,"./util/serializable":16}],5:[function(t,e,r){"use strict";var n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var i=t("debug")("gameboy:gpu:render"),o=t("debug")("gameboy:gpu:control"),u=t("events").EventEmitter,a=t("canvas"),c=t("../util/serializable"),s=t("../registers"),f=s.LCDC,l=s.SCY,h=s.SCX,p=s.WY,_=s.WX,y=s.BGP,d=s.OBP0,v=s.OBP1;t("../util/number");var m=[];m[0]=[255,255,255],m[1]=[192,192,192],m[2]=[96,96,96],m[3]=[0,0,0];var b=160,w=144,L=["_lcdc","_scy","_scx","_wy","_wx","_bgp","_obp0","_obp1"],B=function(t){function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e._video=t,e._lcdc=0,e._scy=0,e._scx=0,e._wy=0,e._wx=0,e._bgp=0,e._obp0=0,e._obp1=0,e._bgpal=null,e._objpal=[],e._canvas=new a(b,w),e._ctx=e._canvas.getContext("2d"),e._image=e._ctx.getImageData(0,0,b,w),e._data=e._image.data,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(r,c({include:L},u)),n(r,[{key:"fromJSON",value:function(t){(function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(n):void 0})(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"fromJSON",this).call(this,t),this._bgpal=this._createPalette(t._bgp),this._objpal[0]=this._createPalette(t._obp0),this._objpal[1]=this._createPalette(t._obp1)}},{key:"readByte",value:function(t){switch(t){case f:return this._lcdc;case l:return this._scy;case h:return this._scx;case y:return this._bgp;case d:return this._obp0;case v:return this._obp1;case p:return this._wy;case _:return this._wx}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case f:return this._lcdc=e;case l:return this._scy=e;case h:return this._scx=e;case y:return this._bgpal=this._createPalette(e),this._bgp=e;case d:return this._objpal[0]=this._createPalette(e),this._obp0=e;case v:return this._objpal[1]=this._createPalette(e),this._obp1=e;case p:return this._wy=e;case _:return this._wx=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"drawLine",value:function(t){var e=this._lcdc>>4&1;if(1&this._lcdc){var r=this._lcdc>>3&1;this._drawBackground(t,this._scx,this._scy,r,e)}if(32&this._lcdc&&t>=this._wy){var n=this._lcdc>>6&1;this._drawWindow(t,this._wx-7,this._wy,n,e)}2&this._lcdc&&this._drawSprites(t)}},{key:"render",value:function(){i("frame"),o("%s",this._lcdc.toString(2)),!1&this._lcdc&&(this._ctx.fillStyle="white",this._ctx.fillRect(0,0,b,w)),this._ctx.putImageData(this._image,0,0),this._ctx.drawImage(this._canvas,0,0),this.emit("frame",this._canvas)}},{key:"_createPalette",value:function(t){return[m[3&t],m[t>>2&3],m[t>>4&3],m[t>>6&3]]}},{key:"_drawBackground",value:function(t,e,r,n,i){for(var o=this._video.bgMap[n],u=r+t,a=0;a<b;a++){var c=e+a,s=o[32*((255&u)>>3)+((255&c)>>3)],f=this._video.tiles[i?s:256+s.signed()],l=this._bgpal[f[7&u][7&c]],h=4*(t*b+a);this._data[h]=l[0],this._data[++h]=l[1],this._data[++h]=l[2],this._data[++h]=255}}},{key:"_drawWindow",value:function(t,e,r,n,i){for(var o=this._video.bgMap[n],u=t-r,a=e;a<b;a++){var c=a-e,s=o[32*(u>>3)+(c>>3)],f=this._video.tiles[i?s:256+s.signed()],l=this._bgpal[f[7&u][7&c]],h=4*(t*b+a);this._data[h]=l[0],this._data[++h]=l[1],this._data[++h]=l[2],this._data[++h]=255}}},{key:"_drawSprites",value:function(r){for(var n=4&this._lcdc?16:8,t=this._video.sprites.filter(function(t){var e=t[0]-16;return e<=r&&r<e+n}).filter(function(t){return t[1]-8<b}).slice(0,10),e=t.length-1;-1<e;e--){var i=t[e],o=i[3];if(!(o>>7&1))for(var u=o>>6&1,a=o>>5&1,c=this._objpal[o>>4&1],s=i[0]-16,f=i[1]-8,l=4&this._lcdc?254&i[2]:i[2],h=u?n-1-(r-s):r-s,p=this._data,_=f;_<f+8&&_<b;_++)if(!(_<0)){var y=4*(r*b+_),d=this._video.tiles[l+(h>>3&1)][7&h][a?7-(_-f):_-f];if(0!=d){var v=c[d];p[y+0]=v[0],p[y+1]=v[1],p[y+2]=v[2],p[y+3]=255}}}}}]),r}();e.exports=B},{"../registers":12,"../util/number":15,"../util/serializable":16,canvas:13,debug:14,events:17}],6:[function(t,e,r){"use strict";var i=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var o=t("debug")("gameboy:lcd:step"),u=t("debug")("gameboy:lcd:stat"),a=t("../util/serializable"),n=t("../registers"),c=n.STAT,s=n.LY,f=n.LYC,l=t("../interrupts"),h=l.INT_40,p=l.INT_48,_=function(t){function n(t,e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var r=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return r._mmu=t,r._gpu=e,r._stat=0,r._ly=0,r._lyc=0,r._t=0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,a({exclude:["_mmu","_gpu"]})),i(n,[{key:"init",value:function(){this._stat=0,this._ly=0,this._lyc=0,this._t=0}},{key:"step",value:function(t){switch(o("%d",t),this._t+=t,3&this._stat){case 2:80<=this._t&&(this._t-=80,this._changeMode(3));break;case 3:172<=this._t&&(this._t-=172,this._changeMode(0),this._gpu.drawLine(this._ly));break;case 0:204<=this._t&&(this._t-=204,this._ly++,this._checkCoincidence(),144==this._ly?(this._changeMode(1),this._mmu.if|=h,this._gpu.render()):this._changeMode(2));break;case 1:456<=this._t&&(this._t-=456,this._ly++,153<this._ly&&(this._ly=0,this._changeMode(2)),this._checkCoincidence())}u("mode=%d; ly=%d",3&this._stat,this._ly)}},{key:"readByte",value:function(t){switch(t){case c:return this._stat;case s:return this._ly;case f:return this._lyc}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t){case c:return this._stat=-121&this._stat|248&e;case s:return this._ly=0;case f:return this._lyc=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_changeMode",value:function(t){var e=!1;switch(t){case 0:8&this._stat&&(e=!0);break;case 1:16&this._stat&&(e=!0);break;case 2:32&this._stat&&(e=!0)}e&&(this._mmu.if|=p),this._stat=-4&this._stat|t}},{key:"_checkCoincidence",value:function(){this._lyc==this._ly?(this._stat|=4,64&this._stat&&(this._mmu.if|=p)):this._stat&=-5}}]),n}();e.exports=_},{"../interrupts":8,"../registers":12,"../util/serializable":16,debug:14}],7:[function(t,e,r){"use strict";var n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var u=t("debug")("gameboy:video:dma"),i=t("../util/serializable"),o=function(t){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);var t=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t._ram=new Uint8Array(8192),t._oam=new Uint8Array(160),t.bgMap=[new Array(1024).fill(0),new Array(1024).fill(0)],t.tiles=t._initTiles(1024),t.sprites=t._initSprites(40),t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,i()),n(e,[{key:"fromJSON",value:function(t){var r=this;(function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(n):void 0})(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"fromJSON",this).call(this,t),this._ram=new Uint8Array(t._ram),this._oam=new Uint8Array(t._oam),this._ram.forEach(function(t,e){return r.writeByte(32768+e,t)}),this._oam.forEach(function(t,e){return r.writeByte(65024+e,t)})}},{key:"transfer",value:function(t,e){var r=(255&e)<<8;u("transfer from 0x%s",r.toString(16));for(var n=r;n<r+160;n++){var i=t.readByte(n),o=255&n;u("copy $%s = 0x%s",n.toString(16),i.toString(16)),this.sprites[o>>2][3&o]=i,this._oam[o]=i}}},{key:"readByte",value:function(t){switch(t>>12){case 8:case 9:return this._ram[8191&t];case 15:if(65183<t)break;if(65023<t)return this._oam[255&t]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t>>12){case 8:case 9:if(38911<t)this.bgMap[t>>10&1][1023&t]=e;else{var r=8191&t,n=this._sumBytes(this._ram[r-1],e);this.tiles[r>>4][r>>1&7]=n}return this._ram[8191&t]=e;case 15:if(65183<t)break;if(65023<t){var i=255&t;return this.sprites[i>>2][3&i]=e,this._oam[i]=e}}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_initTiles",value:function(t){for(var e=[],r=0;r<t;r++)e[r]=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]];return e}},{key:"_initSprites",value:function(t){for(var e=[],r=0;r<t;r++)e[r]=[0,0,0,0];return e}},{key:"_sumBytes",value:function(t,e){for(var r=[],n=7;-1<n;n--){var i=t>>n&1|(e>>n&1)<<1;r[7-n]=i}return r}}]),e}();e.exports=o},{"../util/serializable":16,debug:14}],8:[function(t,e,r){"use strict";r.INT_40=1,r.INT_48=2,r.INT_50=4,r.INT_58=8,r.INT_60=16},{}],9:[function(t,e,r){"use strict";var i=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var o=t("../util/serializable"),n=[];n[0]="ROM ONLY",n[1]="MBC1",n[2]="MBC1+RAM",n[3]="MBC1+RAM+BATTERY",n[5]="MBC2",n[6]="MBC2+BATTERY";var u=[];u[0]=1,u[1]=2,u[2]=4,u[3]=8,u[4]=16;var a=[];a[0]=0,a[1]=1,a[2]=4,a[3]=16;var c=function(t){function n(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)),r=new Uint8Array(t);return e._title=e._sliceToString(r,308,323),e._type=r[327],e._romSize=r[328],e._ramSize=r[329],e._rom=new Uint8Array(r,0,32768*u[e._romSize]),e._ram=new Uint8Array(8192*a[e._ramSize]),e._romBank=1,e._ramBank=0,e._ramEnabled=!1,e._mode=0,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(n,o({exclude:["_rom"]})),i(n,[{key:"fromJSON",value:function(t){(function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(n):void 0})(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"fromJSON",this).call(this,t),this._ram=new Uint8Array(t._ram)}},{key:"readByte",value:function(t){switch(t>>12){case 0:case 1:case 2:case 3:return this._rom[t];case 4:case 5:case 6:case 7:var e=16383&t;return this._rom[16384*this._romBank+e];case 10:case 11:var r=8191&t;return this._ram[8192*this._ramBank+r]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){switch(t>>12){case 0:case 1:return this._ramEnabled=10==(15&e);case 2:case 3:0==(31&(e&=31))&&(e|=1);var r=(96&this._romBank|e)&2*u[this._romSize]-1;return this._romBank=r;case 4:case 5:if(e&=3,1==this._mode)return this._ramBank=e;var n=(31&this._romBank|e<<5)&2*u[this._romSize]-1;return this._romBank=n;case 6:case 7:return this._mode=1&e;case 10:case 11:if(!this._ramEnabled)return;var i=8191&t;return this._ram[8192*this._ramBank+i]=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_sliceToString",value:function(t,e,r){return String.fromCharCode.apply(String,function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}(t.slice(e,r))).replace(/\0/g,"")}}]),n}();e.exports=c},{"../util/serializable":16}],10:[function(t,e,r){"use strict";var n=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var i=t("debug")("gameboy:joypad"),o=t("../registers").JOYP,u=t("../interrupts").INT_60,a=function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this._mmu=t,this._keys={},this._select=0,this._joyp=[15,15]}return n(e,[{key:"keyDown",value:function(t){i("keydown %d",t),this._keys[t]=!0,this._update()}},{key:"keyUp",value:function(t){i("keyup %d",t),this._keys[t]=!1,this._update()}},{key:"readByte",value:function(t){if(t==o)return this._joyp[this._select];throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeByte",value:function(t,e){if(t==o){switch(48&e){case 16:this._select=0;break;case 32:this._select=1}return this._joyp[this._select]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"_update",value:function(){this._joyp=[15,15],this._keys[40]&&(this._joyp[1]&=-9),this._keys[13]&&(this._joyp[0]&=-9),this._keys[38]&&(this._joyp[1]&=-5),this._keys[16]&&(this._joyp[0]&=-5),this._keys[37]&&(this._joyp[1]&=-3),this._keys[90]&&(this._joyp[0]&=-3),this._keys[39]&&(this._joyp[1]&=-2),this._keys[88]&&(this._joyp[0]&=-2),this._mmu.if|=u}}]),e}();e.exports=a},{"../interrupts":8,"../registers":12,debug:14}],11:[function(l,h,t){(function(n){"use strict";var e=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();var i=l("debug")("gameboy:mmu:read"),o=l("debug")("gameboy:mmu:write"),u=l("./io/cart"),a=l("./util/serializable"),t=l("./registers"),c=t.IF,s=t.IE,f=["video","timer","lcd","gpu","joypad"],r=function(t){function r(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e._bios=new Uint8Array(t),e._biosDisabled=0==e._bios.length,e.video=null,e.timer=null,e.lcd=null,e.gpu=null,e.joypad=null,e._wram=new Uint8Array(8192),e._io=new Uint8Array(128),e._zram=new Uint8Array(127),e._cart=null,e.if=0,e.ie=0,e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(r,a({exclude:f})),e(r,[{key:"init",value:function(){this._biosDisabled=0==this._bios.length,this.if=0,this.ie=0}},{key:"fromJSON",value:function(t){(function t(e,r,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,r);if(void 0===i){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,r,n)}if("value"in i)return i.value;var u=i.get;return void 0!==u?u.call(n):void 0})(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"fromJSON",this).call(this,t),this._bios=new Uint8Array(t._bios),this._wram=new Uint8Array(t._wram),this._io=new Uint8Array(t._io),this._zram=new Uint8Array(t._zram)}},{key:"loadCart",value:function(t){this._cart=new u(t)}},{key:"readByte",value:function(t){switch(i("$%s",(t&=65535).toString(16)),t>>12){case 0:if(!this._biosDisabled&&t<256)return this._bios[t];case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:return this._cart.readByte(t);case 8:case 9:return this.video.readByte(t);case 12:case 13:return this._wram[8191&t];case 14:case 15:if(t==s)return this.ie;if(t==c)return this.if;if(65407<t)return this._zram[127&t];if(65279<t){switch(255&t){case 0:return this.joypad.readByte(t);case 4:case 5:case 6:case 7:return this.timer.readByte(t);case 64:case 66:case 67:case 71:case 72:case 73:case 74:case 75:return this.gpu.readByte(t);case 65:case 68:case 69:return this.lcd.readByte(t)}return this._io[255&t]}return 65183<t?0:65023<t?this.video.readByte(t):this._wram[8191&t]}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"readWord",value:function(t){return this.readByte(t)|this.readByte(t+1)<<8}},{key:"writeByte",value:function(t,e){if(e&=255,o("$%s = 0x%s",(t&=65535).toString(16),e.toString(16)),n&&n.env.TEST_ROM&&65282==t&&129==e){var r=String.fromCharCode(this.readByte(65281));n.stdout.write(r)}switch(t>>12){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 10:case 11:return this._cart.writeByte(t,e);case 8:case 9:return this.video.writeByte(t,e);case 12:case 13:return this._wram[8191&t]=e;case 14:case 15:if(t==s)return this.ie=e;if(t==c)return this.if=e;if(65407<t)return this._zram[127&t]=e;if(65279<t){switch(255&t){case 0:return this.joypad.writeByte(t,e);case 4:case 5:case 6:case 7:return this.timer.writeByte(t,e);case 64:case 66:case 67:case 71:case 72:case 73:case 74:case 75:return this.gpu.writeByte(t,e);case 65:case 68:case 69:return this.lcd.writeByte(t,e);case 70:this.video.transfer(this,e);break;case 80:this._biosDisabled=!0}return this._io[255&t]=e}if(65183<t)return;return 65023<t?this.video.writeByte(t,e):this._wram[8191&t]=e}throw new Error("unmapped address 0x"+t.toString(16))}},{key:"writeWord",value:function(t,e){this.writeByte(t,e),this.writeByte(t+1,e>>8)}}]),r}();h.exports=r}).call(this,l("_process"))},{"./io/cart":9,"./registers":12,"./util/serializable":16,_process:19,debug:14}],12:[function(t,e,r){"use strict";r.JOYP=65280,r.DIV=65284,r.TIMA=65285,r.TMA=65286,r.TAC=65287,r.IF=65295,r.LCDC=65344,r.STAT=65345,r.SCY=65346,r.SCX=65347,r.LY=65348,r.LYC=65349,r.DMA=65350,r.BGP=65351,r.OBP0=65352,r.OBP1=65353,r.WY=65354,r.WX=65355,r.IE=65535},{}],13:[function(t,e,r){"use strict";e.exports=function(t,e){var r=document.createElement("canvas");return r.width=t,r.height=e,r}},{}],14:[function(t,e,r){"use strict";e.exports=function(){return function(){}}},{}],15:[function(t,e,r){"use strict";Number.prototype.signed=function(){return 128&this?-(1+(255&~this)):this}},{}],16:[function(t,e,r){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),t}}();function u(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}e.exports=function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function t(){u(this,t)};return function(t){function e(){return u(this,e),function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,r),i(e,[{key:"toJSON",value:function(){var i=this,e=n.exclude,r=n.include,t=function(){return!0};return e&&(t=function(t){return e.indexOf(t)<0}),r&&(t=function(t){return-1<r.indexOf(t)}),Object.keys(this).filter(t).reduce(function(t,e){var r=void 0,n=i[e];return"object"==(void 0===n?"undefined":o(n))?"function"==typeof n.toJSON?r=n.toJSON():"Uint8Array"==n.constructor.name&&(r=Array.from(i[e])):r=i[e],t[e]=r,t},{})}},{key:"fromJSON",value:function(r){var n=this;Object.keys(r).filter(function(t){return n.hasOwnProperty(t)}).forEach(function(t){var e=n[t];"object"==(void 0===e?"undefined":o(e))&&e.fromJSON?e.fromJSON(r[t]):n[t]=r[t]})}}]),e}()}},{}],17:[function(t,e,r){var c=Object.create||function(t){var e=function(){};return e.prototype=t,new e},u=Object.keys||function(t){var e=[];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.push(r);return r},o=Function.prototype.bind||function(t){var e=this;return function(){return e.apply(t,arguments)}};function n(){this._events&&Object.prototype.hasOwnProperty.call(this,"_events")||(this._events=c(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}((e.exports=n).EventEmitter=n).prototype._events=void 0,n.prototype._maxListeners=void 0;var i,a=10;try{var s={};Object.defineProperty&&Object.defineProperty(s,"x",{value:0}),i=0===s.x}catch(t){i=!1}function f(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function l(t,e,r,n){var i,o,u;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),u=o[e]):(o=t._events=c(null),t._eventsCount=0),u){if("function"==typeof u?u=o[e]=n?[r,u]:[u,r]:n?u.unshift(r):u.push(r),!u.warned&&(i=f(t))&&0<i&&u.length>i){u.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+u.length+' "'+String(e)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=u.length,"object"==typeof console&&console.warn&&console.warn("%s: %s",a.name,a.message)}}else u=o[e]=r,++t._eventsCount;return t}function h(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var t=new Array(arguments.length),e=0;e<t.length;++e)t[e]=arguments[e];this.listener.apply(this.target,t)}}function p(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=o.call(h,n);return i.listener=r,n.wrapFn=i}function _(t){var e=this._events;if(e){var r=e[t];if("function"==typeof r)return 1;if(r)return r.length}return 0}function y(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}i?Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(t){if("number"!=typeof t||t<0||t!=t)throw new TypeError('"defaultMaxListeners" must be a positive number');a=t}}):n.defaultMaxListeners=a,n.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return f(this)},n.prototype.emit=function(t){var e,r,n,i,o,u,a="error"===t;if(u=this._events)a=a&&null==u.error;else if(!a)return!1;if(a){if(1<arguments.length&&(e=arguments[1]),e instanceof Error)throw e;var c=new Error('Unhandled "error" event. ('+e+")");throw c.context=e,c}if(!(r=u[t]))return!1;var s="function"==typeof r;switch(n=arguments.length){case 1:!function(t,e,r){if(e)t.call(r);else for(var n=t.length,i=y(t,n),o=0;o<n;++o)i[o].call(r)}(r,s,this);break;case 2:!function(t,e,r,n){if(e)t.call(r,n);else for(var i=t.length,o=y(t,i),u=0;u<i;++u)o[u].call(r,n)}(r,s,this,arguments[1]);break;case 3:!function(t,e,r,n,i){if(e)t.call(r,n,i);else for(var o=t.length,u=y(t,o),a=0;a<o;++a)u[a].call(r,n,i)}(r,s,this,arguments[1],arguments[2]);break;case 4:!function(t,e,r,n,i,o){if(e)t.call(r,n,i,o);else for(var u=t.length,a=y(t,u),c=0;c<u;++c)a[c].call(r,n,i,o)}(r,s,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),o=1;o<n;o++)i[o-1]=arguments[o];!function(t,e,r,n){if(e)t.apply(r,n);else for(var i=t.length,o=y(t,i),u=0;u<i;++u)o[u].apply(r,n)}(r,s,this,i)}return!0},n.prototype.on=n.prototype.addListener=function(t,e){return l(this,t,e,!1)},n.prototype.prependListener=function(t,e){return l(this,t,e,!0)},n.prototype.once=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.on(t,p(this,t,e)),this},n.prototype.prependOnceListener=function(t,e){if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,p(this,t,e)),this},n.prototype.removeListener=function(t,e){var r,n,i,o,u;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=c(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;0<=o;o--)if(r[o]===e||r[o].listener===e){u=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function(t,e){for(var r=e,n=r+1,i=t.length;n<i;r+=1,n+=1)t[r]=t[n];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),n.removeListener&&this.emit("removeListener",t,u||e)}return this},n.prototype.removeAllListeners=function(t){var e,r,n;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=c(null),this._eventsCount=0):r[t]&&(0==--this._eventsCount?this._events=c(null):delete r[t]),this;if(0===arguments.length){var i,o=u(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=c(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(e)for(n=e.length-1;0<=n;n--)this.removeListener(t,e[n]);return this},n.prototype.listeners=function(t){var e,r=this._events;return r&&(e=r[t])?"function"==typeof e?[e.listener||e]:function(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(e):[]},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):_.call(t,e)},n.prototype.listenerCount=_,n.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]}},{}],18:[function(t,a,e){(function(u){(function(){var t,e,r,n,i,o;"undefined"!=typeof performance&&null!==performance&&performance.now?a.exports=function(){return performance.now()}:null!=u&&u.hrtime?(a.exports=function(){return(t()-i)/1e6},e=u.hrtime,n=(t=function(){var t;return 1e9*(t=e())[0]+t[1]})(),o=1e9*u.uptime(),i=n-o):Date.now?(a.exports=function(){return Date.now()-r},r=Date.now()):(a.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)}).call(this,t("_process"))},{_process:19}],19:[function(t,e,r){var n,i,o=e.exports={};function u(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(n===setTimeout)return setTimeout(e,0);if((n===u||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:u}catch(t){n=u}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(t){i=a}}();var s,f=[],l=!1,h=-1;function p(){l&&s&&(l=!1,s.length?f=s.concat(f):h=-1,f.length&&_())}function _(){if(!l){var t=c(p);l=!0;for(var e=f.length;e;){for(s=f,f=[];++h<e;)s&&s[h].run();h=-1,e=f.length}s=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(t)}}function y(t,e){this.fun=t,this.array=e}function d(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];f.push(new y(t,e)),1!==f.length||l||c(_)},y.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=d,o.addListener=d,o.once=d,o.off=d,o.removeListener=d,o.removeAllListeners=d,o.emit=d,o.prependListener=d,o.prependOnceListener=d,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],20:[function(l,h,t){(function(t){for(var n=l("performance-now"),e="undefined"==typeof window?t:window,r=["moz","webkit"],i="AnimationFrame",o=e["request"+i],u=e["cancel"+i]||e["cancelRequest"+i],a=0;!o&&a<r.length;a++)o=e[r[a]+"Request"+i],u=e[r[a]+"Cancel"+i]||e[r[a]+"CancelRequest"+i];if(!o||!u){var c=0,s=0,f=[];o=function(t){if(0===f.length){var e=n(),r=Math.max(0,1e3/60-(e-c));c=r+e,setTimeout(function(){for(var t=f.slice(0),e=f.length=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(c)}catch(t){setTimeout(function(){throw t},0)}},Math.round(r))}return f.push({handle:++s,callback:t,cancelled:!1}),s},u=function(t){for(var e=0;e<f.length;e++)f[e].handle===t&&(f[e].cancelled=!0)}}h.exports=function(t){return o.call(e,t)},h.exports.cancel=function(){u.apply(e,arguments)},h.exports.polyfill=function(t){t||(t=e),t.requestAnimationFrame=o,t.cancelAnimationFrame=u}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"performance-now":18}]},{},[4])(4)});
